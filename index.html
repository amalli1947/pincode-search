<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>India PIN & Village Search</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
body { font-family: Arial; background: #eef2f7; margin: 0; }
.header { background: #0d6efd; color: white; padding: 15px; text-align: center; }
.container { max-width: 700px; margin: auto; padding: 15px; }
.box { background: white; padding: 15px; border-radius: 10px; text-align: center; }
select, input, button { width: 100%; padding: 10px; margin-top: 10px; border-radius: 8px; font-size: 16px; }
button { background: #198754; color: white; border: none; cursor: pointer; }
.village-list { max-height: 250px; overflow-y: auto; margin-top: 10px; background: white; padding: 5px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
.village-item { padding: 8px; border-bottom: 1px solid #ddd; cursor: pointer; border-radius: 5px; }
.village-item:hover { background: #d9f0e3; }
.village-item.active { background: #0d6efd; color: white; font-weight: bold; }
.google-btn { display: inline-block; margin-top: 5px; padding: 5px 10px; background: #4285F4; color: white; text-decoration: none; border-radius: 5px; font-size: 14px; }
#ad-placeholder { margin-top: 15px; text-align: center; }
#map { height: 350px; margin-top: 15px; border-radius: 10px; }
.footer { text-align: center; font-size: 14px; margin: 20px 0; color: #555; }
</style>
</head>

<body>

<div class="header">
  <h2>Andhra Pradesh PIN & Village Search</h2>
</div>

<div class="container">

  <div class="box">
    <input id="pin" placeholder="Enter 6-digit PIN">
    <select id="state"><option value="">Select State</option></select>
    <select id="district"><option value="">Select District</option></select>
    <select id="mandal"><option value="">Select Mandal</option></select>
    <select id="village"><option value="">Select Village</option></select>
    <button onclick="search()">Search</button>
  </div>

  <div id="ad-spot-1" class="ad-placeholder">
      <div style="background:#f0f0f0; color:#555; padding:10px; border-radius:5px;">Ad Spot 1</div>
  </div>

  <div id="villages" class="village-list"></div>

  <div id="ad-spot-2" class="ad-placeholder">
      <div style="background:#f0f0f0; color:#555; padding:10px; border-radius:5px;">Ad Spot 2</div>
  </div>

  <div id="map"></div>

  <div id="ad-spot-3" class="ad-placeholder">
      <div style="background:#f0f0f0; color:#555; padding:10px; border-radius:5px;">Ad Spot 3</div>
  </div>

  <div class="footer">© 2025 Andhra Pradesh PIN Code Search</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let map, marker, activeVillage=null;
map = L.map('map').setView([16.5, 80.6],6); // Center Andhra Pradesh
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution:'© OpenStreetMap' }).addTo(map);

// Full State & Districts for Andhra Pradesh
const data = {
  "Andhra Pradesh": {
    "Anantapur": {},
    "Chittoor": {},
    "East Godavari": {},
    "Guntur": {},
    "Krishna": {},
    "Kurnool": {},
    "Prakasam": {},
    "Srikakulam": {},
    "Visakhapatnam": {},
    "Vizianagaram": {},
    "West Godavari": {},
    "YSR Kadapa": {}
  }
};

const stateSelect=document.getElementById("state");
const districtSelect=document.getElementById("district");
const mandalSelect=document.getElementById("mandal");
const villageSelect=document.getElementById("village");

// Populate states
function populateStates(){
  stateSelect.innerHTML='<option value="">Select State</option>';
  for(let s in data){ stateSelect.innerHTML += `<option value="${s}">${s}</option>`; }
  districtSelect.innerHTML='<option value="">Select District</option>';
  mandalSelect.innerHTML='<option value="">Select Mandal</option>';
  villageSelect.innerHTML='<option value="">Select Village</option>';
}
populateStates();

// Update district dropdown
stateSelect.onchange=function(){
  let state=this.value;
  districtSelect.innerHTML='<option value="">Select District</option>';
  mandalSelect.innerHTML='<option value="">Select Mandal</option>';
  villageSelect.innerHTML='<option value="">Select Village</option>';
  if(state && data[state]){
    for(let d in data[state]){
      districtSelect.innerHTML += `<option value="${d}">${d}</option>`;
    }
  }
}

// Clear mandal & village on district change
districtSelect.onchange=function(){
  mandalSelect.innerHTML='<option value="">Select Mandal</option>';
  villageSelect.innerHTML='<option value="">Select Village</option>';
}

// Clear village on mandal change
mandalSelect.onchange=function(){
  villageSelect.innerHTML='<option value="">Select Village</option>';
}

// Search (PIN or dropdown)
function search(){
  let pin=document.getElementById("pin").value.trim();
  let state=stateSelect.value;
  let district=districtSelect.value;
  let mandal=mandalSelect.value;
  let village=villageSelect.value;
  let villagesDiv=document.getElementById("villages");
  villagesDiv.innerHTML="";

  if(pin){
    fetch("https://api.postalpincode.in/pincode/"+pin)
      .then(r=>r.json())
      .then(d=>{
        if(d[0].Status==="Success"){
          d[0].PostOffice.forEach(p=>{
            addVillage(p.Name,p.District,p.State,p.Pincode);
          });
        } else villagesDiv.innerHTML="No data found";
      });
  } else if(state && district){
    addVillage(district,district,state,"");
  } else {
    villagesDiv.innerHTML="Enter PIN or select State & District";
  }
}

// Add village item
function addVillage(village,district,state,pin){
  let villagesDiv=document.getElementById("villages");
  let div=document.createElement("div");
  div.className="village-item";
  div.innerHTML=`<b>${village}</b> (${district},${state}) PIN: ${pin}`;
  div.onclick=()=>goToVillage(village,district,state,pin,div);
  villagesDiv.appendChild(div);
}

// Map functions
function goToVillage(village,district,state,pin,el){
  let query = `${village}, ${district}, ${state}, India`;
  if(activeVillage) activeVillage.classList.remove("active");
  el.classList.add("active");
  activeVillage=el;

  fetch("https://nominatim.openstreetmap.org/search?format=json&q="+encodeURIComponent(query))
    .then(r=>r.json())
    .then(loc=>{
      if(loc.length>0){
        showMarker(loc[0].lat,loc[0].lon,village,district,state,pin,el);
      } else alert("Location not found");
    });
}

function showMarker(lat,lon,village,district,state,pin,el){
  if(marker) map.removeLayer(marker);
  marker=L.marker([lat,lon]).addTo(map)
    .bindPopup(`<b>${village}</b><br>${district}, ${state}<br>PIN: ${pin}`)
    .openPopup();
  map.setView([lat,lon],10);

  let existingLink=el.querySelector(".google-btn");
  if(existingLink) existingLink.remove();

  let link=document.createElement("a");
  link.href=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(village+", "+district+", "+state+", India")}`;
  link.target="_blank";
  link.className="google-btn";
  link.innerText="Open in Google Maps";
  el.appendChild(link);
}
</script>

</body>
</html>
